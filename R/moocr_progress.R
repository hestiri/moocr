
moocr_progress <- function(){
    proceedstatus <- readline("The following procedure to import your data may take a while since the table course_progress is likely to be large. Do you want to proceed? (y/n): ")
    if (proceedstatus == "y") {
        
        # this is for ordering course items withing lessons and modules
        ordering <- function(x, y, z) {
            temp <<- x %>% 
                dplyr::left_join(y, by = "course_lesson_id", `copy`=TRUE) %>% 
                dplyr::left_join(z, by = "course_module_id", `copy`=TRUE) %>%
                dplyr::arrange(course_module_order, course_lesson_order, course_item_order) %>% 
                dplyr::mutate(item_rank = row_number())
        }
        
        itemorder <<- purrr::map(1:numcourses, ~ ordering(all_tables[["course_items"]][[.x]], all_tables[["course_lessons"]][[.x]], all_tables[["course_modules"]][[.x]]))
        
        
        progress <- function(x, y){

            temp <- x %>%
                dplyr::filter(!is.na(course_progress_ts)) %>%
                dplyr::group_by(jhu_user_id) %>%
                dplyr::filter(course_progress_ts == max(course_progress_ts)) %>% # only to record the last activity
                dplyr::left_join(y, by = "course_item_id", `copy`=TRUE) %>% # so that we know the name of the course item
                dplyr::group_by(item_rank) %>%
                dplyr::summarise(Total=n()) %>%
                dplyr::arrange(desc(Total)) %>%
                dplyr::mutate(Share=round(Total/sum(Total), 2)) %>% 
                dplyr::left_join(y, by = "item_rank")
            }

        last_activity <- purrr::map(1:numcourses, ~ progress(all_tables[["course_progress"]][[.x]], itemorder[[.x]]))
        names(last_activity) <- coursenames
        return(last_activity)
        
    }
}





